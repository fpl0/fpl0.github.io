---
/**
 * AppShell - Minimal standalone layout for full-viewport apps
 *
 * Unlike the blog Layout, this provides only:
 * - Common BaseHead (Theme, Fonts, Meta, Transitions)
 * - A thin top bar with back link to home + search hint
 * - Theme toggle + SearchModal (Cmd+K)
 * - Full-viewport content area via <slot />
 *
 * No ScrollToTop or Analytics — apps are standalone.
 */

import "../styles/global.css";
import "../styles/app-shell.css";

import BaseHead from "../components/BaseHead.astro";
import Link from "../components/Link.astro";
import SearchModal from "../components/SearchModal.astro";
import ThemeToggle from "../components/ThemeToggle.astro";

interface Props {
  title: string;
  description?: string;
}

const { title, description = "An interactive app on fpl0's blog." } = Astro.props;
---

<!doctype html>
<html lang="en">
	<head>
		<BaseHead {title} {description} />
	</head>
	<body class="app-shell-body">
		<header class="app-shell-bar">
			<nav class="app-shell-nav" aria-label="App navigation">
				<Link href="/" class="app-shell-link"><span class="app-shell-back" aria-hidden="true">&larr;</span> fpl0</Link>
			</nav>
			<Link href="/" class="app-shell-title">
				<span class="app-shell-title-back" aria-hidden="true">&larr;</span>
				{title}
			</Link>
			<div class="app-shell-right">
				<button
					class="app-shell-search"
					id="app-shell-search"
					type="button"
					aria-label="Search"
					aria-controls="search-backdrop"
				>
					<svg class="app-shell-search-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
						<circle cx="11" cy="11" r="8"></circle>
						<line x1="21" y1="21" x2="16.65" y2="16.65"></line>
					</svg>
					<span class="app-shell-search-text">search</span>
					<kbd class="app-shell-search-kbd">⌘K</kbd>
				</button>
				<ThemeToggle />
			</div>
		</header>
		<SearchModal />
		<main class="app-shell-content" id="main-content">
			<slot />
		</main>
	</body>
</html>

<style>
	/* Override blog body constraints — apps need full viewport */
	.app-shell-body {
		max-width: none;
		margin: 0;
		padding: 0;
		overflow: hidden;
		height: 100vh;
	}

	/* Place theme toggle inline within the bar instead of floating */
	.app-shell-right :global(.theme-toggle) {
		position: static;
		width: var(--space-8);
		height: var(--space-8);
	}

	.app-shell-right :global(.theme-toggle .icon) {
		width: var(--space-4);
		height: var(--space-4);
	}

</style>

<script>
	import { onPageReady } from "../utils/lifecycle";
	import { openSearch } from "../utils/search-trigger";

	onPageReady((signal) => {
		const btn = document.getElementById("app-shell-search");
		btn?.addEventListener("click", () => openSearch(), { signal });
	});
</script>
