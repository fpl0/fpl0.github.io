---
/**
 * Tag Index Page - Lists all tags with counts from posts and apps
 */

import Link from "../../components/Link.astro";
import PageHeader from "../../components/PageHeader.astro";
import Layout from "../../layouts/Layout.astro";
import { getPublishedApps, getPublishedPosts } from "../../utils/content";
import "../../styles/tags.css";

const [posts, apps] = await Promise.all([getPublishedPosts(), getPublishedApps()]);

const tagCounts = new Map<string, number>();
for (const post of posts) {
  for (const tag of post.data.tags) {
    tagCounts.set(tag, (tagCounts.get(tag) ?? 0) + 1);
  }
}
for (const app of apps) {
  for (const tag of app.data.tags) {
    tagCounts.set(tag, (tagCounts.get(tag) ?? 0) + 1);
  }
}

const sortedTags = [...tagCounts.entries()].sort((a, b) => a[0].localeCompare(b[0]));
---

<Layout title="Tags | fpl0" description="Browse all tags">
  <PageHeader />

  <main id="main-content" class="tags-main">
    <h1 class="tags-title">Tags</h1>
    {sortedTags.length > 0 ? (
      <div class="tags-grid">
        {sortedTags.map(([tag, count]) => (
          <Link href={`/tags/${tag}/`} class="tag-card">
            <span class="tag-card-name">{tag}</span>
            <span class="tag-card-count">{count}</span>
          </Link>
        ))}
      </div>
    ) : (
      <p class="empty-state">No tags yet.</p>
    )}
  </main>
</Layout>

<style>
  .tags-main {
    padding-top: var(--space-4);
  }

  .tags-title {
    font-family: var(--font-serif);
    font-size: var(--font-size-h1);
    margin-top: 0;
    margin-bottom: var(--space-10);
  }

  .tags-grid {
    display: flex;
    flex-wrap: wrap;
    gap: var(--space-3);
  }

  .tag-card-count {
    font-size: var(--font-size-label);
    color: var(--color-muted);
  }
</style>
